<!DOCTYPE html>
<html lang="en-GB">
 <head>
    <meta charset="utf-8" />
    <title>Video Game</title>                            <!--Page title, invisible on browser page-->
    <link rel="stylesheet" href="styles.css" />                 <!--Reference to external CSS file-->
 </head>

 <body>
  <header>
   <h1>Video Game</h1>                                     <!--Page title, visible on browser page-->
  </header>

  <h2>Chicken Crossing
    <img src = "Banner.gif" title = "Chicken Crossing logo banner">
  </h2>

  <p>This game's resolution is 1024 x 576, with the 16:9 aspect ratio typically used for
     Youtube videos. Handy if you wish to record the gameplay.<br>
     Keyboard scrolling is disabled on this page, for obvious reasons.
  </p>

  <div class = "Stage">
   <canvas id = "canvas"></canvas>
  </div>

  <p><strong><u>Context</u></strong><br>
    On a farm one day, a farmer is preparing to cull his older livestock. He mistakenly leaves the 
    gate to the chicken coop open whilst he tends to an urgent matter. Seizing the opportunity, one
    rooster darts out. Noticing the escape attempt, the farmer charges for the lone rooster
    in a spontaneous impulse, forgetting to close the coop gate to prevent the others from
    escaping too.<br>
    Why the error in judgment you ask? The short answer is spite. The long answer is that the
    rooster had a turbulent history with the farmer, frequently pecking and biting his fingers 
    and beating him with his wings whilst he came to dispense the grain feed.<br>
    Through his zealous vendetta against the rooster, the farmer was adamant to prevent him from
    fleeing with his life, even at the expense of losing a few hens in the process.<br>
    How will the story play out? The good news is that the outcome is in your hands!
    <br><br>
     <strong><u>Controls:</u></strong><br><br>
     <strong>Left</strong> and <strong>Right</strong> arrow keys for sideways motion<br>
     <strong>Spacebar</strong> to jump<br>
     <strong>Up</strong> arrow key when airborne to flap to gain altitude<br><br>
     <strong>This game has three different endings, which are listed in the timeline when they were
      added to the game (newer additions appear further down):</strong><br>
      <ol>
        <li><strong>Recluse:</strong> To reach this ending, finish level 1 via the drain, taking you 
          to the sewer, where you then complete level 2 normally, finishing that level through the 
          drain as well. Then complete the rest of the game.
        </li><br>
        <li><strong>Community:</strong> To reach this ending, finish level 1 by ascending all the way
          up the water column. Then complete the rest of the game.
        </li><br>
        <li><strong>Enlightened:</strong> To reach this ending, finish level 1 through the drain.
          On level 2, bounce off the second bat as it approaches its highest position to glitch your
          avatar through the ceiling. Use 4-5 stamina points to ascend the rest of the way up
          through the purple layer until you reach the green layer. Head right until you see the
          portal and jump up to the surface normally. Enter the portal and complete the rest of the 
          game.
        </li><br>
      </ol><br>
     Enjoy the Game
  </p>

 </body>

 <script>

  var gravity = 0.6; var friction = 0.7;

  // Below, the image files are referenced and uploaded
  var Background = new Image(); Background.src = "BackgroundL1.jpg"; 
  const X_b = [-10, -10, -10, -10, -10, -10]; const Y_b = [-1100, -700, -400, -1500, -400, -100]; 
  const X_bw = [1500, 1750, 10000, 2000, 2500, 1100]; 
  const Y_bw = [1800, 2000, 1000, 5000, 1000, 3000];
  var x_b = JSON.parse(JSON.stringify(X_b[0])); 
  var y_b = JSON.parse(JSON.stringify(Y_b[0]));
  // Function to render the canvas
  function RenderCanvas() {ctx.drawImage(Background, x_b, y_b, X_bw[Level-1], Y_bw[Level-1])};

  var Chicken = new Image(); Chicken.src = "ChickenR.gif"; // Our beloved protagonist <:-)
  var DuckImage = []; var PigeonImage = []; var DrainImage = [];
  var Farmer = new Image(); Farmer.src = "Farmer.gif"; // Our accursed nemesis >:-(
  var Hills = []; var PlatformImage = []; var BlockImage = []; 

  // A separate render is made for each instance of the map characters
  function ImageLoad() {
  if (Level == 1) {DuckImage = [new Image(), new Image(), new Image()]; 
    DuckImage[0].src = "DuckR.gif"; DuckImage[1].src = "DuckR.gif"; DuckImage[2].src = "DuckR.gif";
    PigeonImage = [new Image(), new Image(), new Image()]; 
    PigeonImage[0].src = "Pigeon.gif"; PigeonImage[1].src = "Pigeon.gif"; 
    PigeonImage[2].src = "Pigeon.gif";
    DrainImage = new Image(); DrainImage.src = "Drain.gif"
                  };
  if (Level == 2) {DuckImage = [new Image(), new Image()]; 
    DuckImage[0].src = "RatR.gif"; DuckImage[1].src = "FishR.gif";
    PigeonImage = [new Image(), new Image()]; 
    PigeonImage[0].src = "Bat.gif"; PigeonImage[1].src = "Bat.gif";
    DrainImage = [new Image(), new Image(), new Image()]; 
    DrainImage[0].src = "Drain.gif"; DrainImage[1].src = "Drain.gif"; DrainImage[2].src = "Portal.jpg"
                  };
  if (Level == 3) {DuckImage = []; PigeonImage = []; DrainImage = []};
  if (Level == 4) {DuckImage = [new Image(), new Image()]; 
    DuckImage[0].src = "DuckR.gif"; DuckImage[1].src = "DuckR.gif";
    PigeonImage = [new Image(), new Image(), new Image(), new Image()]; 
    PigeonImage[0].src = "Pigeon.gif"; PigeonImage[1].src = "Pigeon.gif"; 
    PigeonImage[2].src = "Pigeon.gif"; PigeonImage[3].src = "Pigeon.gif";
    DrainImage = new Image(); DrainImage.src = "Shark.gif"
                  };
  if (Level == 5) {
    for (let c = 0; c < 9; c++) {DuckImage[c] = new Image(); DuckImage[c].src = "ChickenNPC.gif"};
    PigeonImage = []; DrainImage = []
                  };
  if (Level == 6) {DuckImage = [new Image(), new Image()]; 
    DuckImage[0].src = "Boost.gif"; DuckImage[1].src = "Boost.gif";
    PigeonImage = [new Image(), new Image(), new Image()]; 
    PigeonImage[0].src = "Boost.gif"; PigeonImage[1].src = "Boost.gif"; 
    PigeonImage[2].src = "Boost.gif";
    DrainImage = new Image(); DrainImage.src = "Bike.gif";
    Hills = new Image(); Hills.src = "HillsL6.gif";
    PlatformImage = new Image(); PlatformImage.src = "Platform.gif";
    BlockImage = new Image; BlockImage.src = "Block.gif";
                  };                
                       };

  // Function to render the player
  function RenderPlayer()
    {ctx.drawImage(Chicken, Player.x, Player.y, Player.width, Player.height)};
  // Note: +x is right, +y is down for all coordinates
  
  var Level = 1; // The number specifies the map to be loaded

  // These arrays will be filled in accordance with the level specifications
  var Spawn; var Ground = []; var Platform = []; var Obstacle = []; var Duck = []; var Pigeon = []; 
  var Water = []; var Drain = []; var Predator = []; var MapSpec = [];

  function LevelLoad() {// Where the fun of level-building happens! >:-D
    if (Level == 1) {canvas.onclick = [];
      Spawn = {x: 30, y: 200};

      Water[0] = {x: 3800, y: -4000, width: 100, height: 4556};

      Ground[0] = {x: 0, y: 556, width: 2050, height: 40};
      Ground[1] = {x: 2300, y: 556, width: 1700, height: 40};
        
      Platform[0] = {x: 500, y: 200, width: 110, height: 15};
      Platform[1] = {x: 800, y: 230, width: 110, height: 15};
      Platform[2] = {x: 1200, y: 30, width: 110, height: 15};
      Platform[3] = {x: 1550, y: 406, width: 350, height: 15};
      Platform[4] = {x: 1600, y: 511, width: 350, height: 15};

      Obstacle[0] = {x: 300, y: 456, width: 50, height: 100};
      Obstacle[1] = {x: 650, y: 406, width: 50, height: 150};
      Obstacle[2] = {x: 1500, y: 406, width: 50, height: 150};
      Obstacle[3] = {x: 1500, y: -124, width: 500, height: 500};
      Obstacle[4] = {x: 1950, y: 376, width: 50, height: 150};
      Obstacle[5] = {x: 2500, y: 300, width: 50, height: 50};
      Obstacle[6] = {x: 2500, y: 400, width: 50, height: 50};
      Obstacle[7] = {x: 2500, y: 500, width: 50, height: 50};
      Obstacle[8] = {x: 2700, y: 400, width: 200, height: 156};
      Obstacle[9] = {x: 3900, y: -4000, width: 1000, height: 4556};
  
      Duck[0] = {x: 1300, y: 526, x_v: -1, width: 20, height: 20};
      Duck[1] = {x: 1750, y: 375, x_v: 1, width: 20, height: 20};
      Duck[2] = {x: 3000, y: 300, x_v: -1, width: 100, height: 100};

      Pigeon[0] = {x: 1000, y: 0, y_v: 1, width: 20, height: 20};
      Pigeon[1] = {x: 2100, y: -100, y_v: 1, width: 20, height: 20};
      Pigeon[2] = {x: 2400, y: 275, y_v: 1, width: 50, height: 50};

      Drain[0] = {x: 3500, y: 506, width: 100, height: 50};

      Predator[0] = {x: -1000, y: 10, x_v: 2.25, width: 550, height: 550};

      MapSpec = [Spawn, Water, Ground, Platform, Obstacle, Duck, Pigeon, Drain, Predator]
                    };

    if (Level == 2) {canvas.onclick = [];
      Spawn = []; Spawn = {x: 35, y: 42};

      Water = [];
      Water[0] = {x: 1100, y: 750, width: 1500, height: 150};
      Water[1] = {x: 295, y: -100, width: 100, height: 140};

      Ground = [];
      Ground[0] = {x: 0, y: 1060, width: 0, height: 0};
      Ground[1] = {x: 0, y: 40, width: 10, height: 40};
      Ground[2] = {x: 80, y: 40, width: 2600, height: 40};
      Ground[3] = {x: 80, y: 40, width: 2600, height: 40};
      Ground[4] = {x: 3020, y: 40, width: 80, height: 40};
    
      Platform = [];
      Platform[0] = {x: 1500, y: 735, width: 110, height: 15};
      Platform[1] = {x: 2700, y: 500, width: 50, height: 15};
      Platform[2] = {x: 2950, y: 300, width: 50, height: 15};
    
      Obstacle = [];
      Obstacle[0] = {x: 0, y: 80, width: 10, height: 1020};
      Obstacle[1] = {x: 80, y: 80, width: 120, height: 930};
      Obstacle[2] = {x: 10, y: 1040, width: 1090, height: 60};
      Obstacle[3] = {x: 300, y: 840, width: 100, height: 200};
      Obstacle[4] = {x: 500, y: 690, width: 100, height: 350};
      Obstacle[5] = {x: 1000, y: 690, width: 100, height: 350};
      Obstacle[6] = {x: 160, y: 80, width: 2520, height: 420};
      Obstacle[7] = {x: 1100, y: 900, width: 1500, height: 200};
      Obstacle[8] = {x: 2600, y: 690, width: 400, height: 410};
      Obstacle[9] = {x: 3020, y: 80, width: 80, height: 1020};
      Obstacle[10] = {x: 2700, y: 40, width: 300, height: 10};
      Obstacle[11] = {x: 10, y: 40, width: 20, height: 1000};
      Obstacle[12] = {x: 60, y: 40, width: 20, height: 970};
      Obstacle[13] = {x: 2680, y: 40, width: 20, height: 460};
      Obstacle[14] = {x: 3000, y: 40, width: 20, height: 1060};
      Obstacle[15] = {x: 395, y: -100, width: 1000, height: 140};
      Obstacle[16] = {x: 10, y: 30, width: 60, height: 10};

      Duck = [];
      Duck[0] = {x: 900, y: 1000, x_v: -1, width: 20, height: 20};
      Duck[1] = {x: 2000, y: 750, x_v: -1, width: 600, height: 150};

      Pigeon = [];
      Pigeon[0] = {x: 750, y: 700, y_v: 1, width: 50, height: 50};
      Pigeon[1] = {x: 1300, y: 500, y_v: 1, width: 100, height: 100};

      Drain = [];
      Drain[0] = {x: -5, y: -10, width: 100, height: 50};
      Drain[1] = {x: 2700, y: 40, width: 300, height: 40};
      Drain[2] = {x: 2300, y: -160, width: 100, height: 200};

      MapSpec = [];
      MapSpec = [Spawn, Water, Ground, Platform, Obstacle, Duck, Pigeon, Drain]
                    }; 
                    
    if (Level == 3) {canvas.onclick = [];
      Spawn = []; Spawn = {x: 30, y: 200};

      Ground = []; Ground[0] = {x: 0, y: 556, width: 10000, height: 40};

      Predator = []; Predator[0] = {x: -1000, y: 10, x_v: 2.7, width: 550, height: 550};

      MapSpec = [];
      MapSpec = [Spawn, Ground, Predator]
                    };
                    
    if (Level == 4) {canvas.onclick = [];
      Spawn = []; Spawn = {x: 30, y: 300};

      Water = [];
      Water[0] = {x: 0, y: 3400, width: 5000, height: 500}; // y == 0 at sea level, would you believe it?

      Ground = [];
      Ground[0] = {x: 0, y: 3730, width: 0, height: 0};
      Ground[1] = {x: 5000, y: 3400, width: 1000, height: 500};
        
      Platform = [];
      Platform[0] = {x: 4700, y: 3300, width: 400, height: 10};
      Platform[1] = {x: 5100, y: 3300, width: 30, height: 100};

      Obstacle = [];
      Obstacle[0] = {x: 0, y: 400, width: 100, height: 50};
      Obstacle[1] = {x: 200, y: 300, width: 500, height: 150};
      Obstacle[2] = {x: 220, y: 250, width: 50, height: 50};
      Obstacle[3] = {x: 630, y: 250, width: 50, height: 50};
      Obstacle[4] = {x: 1700, y: -600, width: 600, height: 100};
      Obstacle[5] = {x: 2300, y: -520, width: 500, height: 20};
      Obstacle[6] = {x: 2800, y: -600, width: 500, height: 100};
  
      Duck = [];
      Duck[0] = {x: 300, y: 190, x_v: 1, width: 100, height: 100};
      Duck[1] = {x: 2400, y: -650, x_v: 1, width: 100, height: 100};

      Pigeon = [];
      Pigeon[0] = {x: 850, y: 300, y_v: -1, width: 100, height: 100};
      Pigeon[1] = {x: 1000, y: -100, y_v: 1, width: 100, height: 100};
      Pigeon[2] = {x: 1150, y: -300, y_v: -1, width: 100, height: 100};
      Pigeon[3] = {x: 1300, y: -700, y_v: 1, width: 100, height: 100};

      Drain = []; Drain[0] = {x: -1000, y: 3300, width: 100, height: 260};

      Predator = []; Predator[0] = {x: -1000, y: 10, x_v: 2, width: 550, height: 550};

      MapSpec = [];
      MapSpec = [Spawn, Water, Ground, Platform, Obstacle, Duck, Pigeon, Drain, Predator]
                    };
                    
    if (Level == 5) {canvas.onclick = [];
      Spawn = []; Spawn = {x: 30, y: 200};

      Ground = []; Ground[0] = {x: 0, y: 556, width: 10000, height: 40};

      Duck = []; for (let d = 0; d < 9; d++)
        {Duck[d] = {x: 1000 + 1500*d, y: 500, x_v: 1, width: 50, height: 50}};
  
      MapSpec = [];
      MapSpec = [Spawn, Ground, Duck]
                    };
                    
    if (Level == 6) {canvas.onclick = [];
      Spawn = {x: 30, y: 200};

      Water[0] = {x: -10, y: 200, width: 5000, height: 400}; // Background hills

      Ground[0] = {x: 0, y: 556, width: 3000, height: 40};
      Ground[1] = {x: 4000, y: 556, width: 6000, height: 40};
        
      Platform[0] = {x: 2000, y: 200, width: 1000, height: 100};
      Platform[1] = {x: 5000, y: 200, width: 1000, height: 100};

      Obstacle[0] = {x: 1000, y: 356, width: 100, height: 200};
      Obstacle[1] = {x: 1700, y: 356, width: 100, height: 200};
      Obstacle[2] = {x: 4500, y: 106, width: 100, height: 200};
      Obstacle[3] = {x: 4500, y: 356, width: 100, height: 200};
      Obstacle[4] = {x: 7000, y: 356, width: 100, height: 200};
      Obstacle[5] = {x: 7600, y: 356, width: 100, height: 200};
  
      Duck[0] = {x: 2800, y: 100, width: 100, height: 100};
      Duck[1] = {x: 5800, y: 100, width: 100, height: 100};

      Pigeon[0] = {x: 500, y: 200, y_v: 1, width: 100, height: 100};
      Pigeon[1] = {x: 6500, y: 200, y_v: 1, width: 100, height: 100};
      Pigeon[2] = {x: 8000, y: 200, y_v: 1, width: 100, height: 100};

      Drain[0] = {x: 9700, y: 506, width: 200, height: 50};

      Predator[0] = {x: -1000, y: 10, x_v: 5, width: 550, height: 550};

      MapSpec = [Spawn, Water, Ground, Platform, Obstacle, Duck, Pigeon, Drain, Predator]
                    };
                
                    // Gotta call it from the beginning, otherwise Level 1 won't load
                       }; LevelLoad(); 

  // The map may need to be reset and reloaded
  var Map = JSON.parse(JSON.stringify(MapSpec));
  /* A simple "=" assignment alone means that any changes to the copy will also carry over to
     the original, something that should be avoided */

  const Player = {x: Map[0].x, y: Map[0].y, x_v: 0, y_v: 0, jump: true, bounce: false,
                  height: 20, width: 20, Stamina: 5, Lives: 5, Surprised: false};  
  
  const keys = {right: false, left: false, up: false, down: false}; // Arrow key status
 
  // Function to render the map
  function RenderMap() {for (let i = 1; i < Map.length; i++) {
    for (let j = 0; j < Map[i].length; j++) {
    if (i == 1) {ctx.fillStyle = "darkcyan"; 
      if (Level == 2 && j == 0) {ctx.fillStyle = "darkslategrey"};
      if (Level == 3) {ctx.fillStyle = "orangered"};
      if (Level == 5) {ctx.fillStyle = "#ffeb99"};
      if (Level == 6) 
        {ctx.drawImage(Hills, Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)}}; 
    if (i == 2) {if (Level == 1 || Level == 2) {ctx.fillStyle = "green"};
      if (Level == 3) 
        {ctx.drawImage(Farmer, Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)};
      if (Level == 4) {ctx.fillStyle = "goldenrod"};
      if (Level == 5) 
        {ctx.drawImage(DuckImage[j], Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)};
      if (Level == 6) {ctx.fillStyle = "deeppink"};
                };
    if (i == 3) {ctx.fillStyle = "brown";
      if (Level == 6) 
        {ctx.drawImage(PlatformImage, Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)}}; 
    if (i == 4) {ctx.fillStyle = "yellow"; 
      if (Level == 2) {ctx.fillStyle = "purple"; if (j == 15) {ctx.fillStyle = "yellow"}};
      if (Level == 4) {ctx.fillStyle = "#e6ffff"};
      if (Level == 6) 
        {ctx.drawImage(BlockImage, Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)}};
    if (i == 5) 
      {ctx.drawImage(DuckImage[j], Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height);};
    if (i == 6) 
      {ctx.drawImage(PigeonImage[j], Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)};
    if (i == 7) {if (Level == 1 || Level == 4 || Level == 6) 
        {ctx.drawImage(DrainImage, Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)};
        if (Level == 2) {
        {ctx.drawImage(DrainImage[j], Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)}}};
    if (i == 8) 
      {ctx.drawImage(Farmer, Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)};
     
    if ((Level == 1 || Level == 2 || Level == 4) && i != 5 && i != 6 && i != 7 && i != 8) 
      {{ctx.fillRect(Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)}};
    if ((Level == 3 || Level == 5) && i != 2) 
      {{ctx.fillRect(Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)}};
    if (Level == 6 && i == 2) 
      {{ctx.fillRect(Map[i][j].x, Map[i][j].y, Map[i][j].width, Map[i][j].height)}};                                   
                                           }                }
                       };                             

  // This function will be called when a key on the keyboard is pressed
  function keydown(e) {
  // 37 is the code for the left arrow key
  if(e.keyCode == 37) {keys.left = true};
  // 32 is the code for the spacebar
  if(e.keyCode == 32) {if (Player.jump == false) {Player.y_v = -15}};
  // 38 is the code for the up arrow key
  if(e.keyCode == 38) {keys.up = true};

  document.body.onkeyup = function(e) {if(e.keyCode == 38 && Player.jump) {
    // Flapping physics; each flap costs a stamina point (see chicken wing icon)
    if (Player.Stamina > 0) {Player.y_v = -10; Player.Stamina--}          }
                                      };

  // 39 is the code for the right arrow key
  if(e.keyCode == 39) {keys.right = true};
  // 40 is the code for the down arrow key
  if(e.keyCode == 40) {keys.down = true}
                      };

  // Gotta replenish that stamina somehow, one point per five seconds seems fair
  setInterval(function () {if (Player.Stamina < 5) {Player.Stamina++}}, 5000);                                   

  // This function is called when the pressed key is released
  function keyup(e) {
  if (e.keyCode == 37) {keys.left = false};
  if (e.keyCode == 32) {if(Player.y_v < -2) {Player.y_v = -3}};
  if (e.keyCode == 38) {keys.up = false};
  if (e.keyCode == 39) {keys.right = false};
  if (e.keyCode == 40) {keys.down = false};
                    }; 

  var Scroll = [false, false]; // Level's too big to fit on-stage, therefore the map is scrolled
  
  function ScrollConditions() {// To scroll or not to scroll, that is the question...
    if (Level != 3 && Level != 5 && Level != 6) {if (Player.x - Map[2][0].x >= 512 &&
        Map[2][Map[2].length-1].x + Map[2][Map[2].length-1].width - Player.x >= 512) 
    {Scroll[0] = true} else {Scroll[0] = false} };
    if (Level == 3 || Level == 5) {if (Player.x - Map[1][0].x >= 512 &&
        Map[1][0].x + Map[1][0].width - Player.x >= 512) 
    {Scroll[0] = true} else {Scroll[0] = false}};
    if (Level == 6) {if (Player.x - Map[2][0].x >= 512 &&
        Map[2][1].x + Map[2][1].width - Player.x >= 520) {Scroll[0] = true} else {Scroll[0] = false}};
    if (Level == 1) {if (Map[2][0].y - Player.y > 526 && Player.y - Map[4][9].y > 40) 
      {Scroll[1] = true} else {Scroll[1] = false}};
    if (Level == 2) 
      {if (Map[2][0].y - Player.y > 526 && Map[2][0].y - Player.y < 1675) 
        {Scroll[1] = true} else {Scroll[1] = false}};
    if (Level == 4 || Level == 6) 
      {if (Map[2][0].y - Player.y > 526 && Map[1][0].y - Player.y < 4000) 
        {Scroll[1] = true} else {Scroll[1] = false}};
    if (Level == 3 || Level == 5) 
      {if (Map[1][0].y - Player.y > 526) {Scroll[1] = true} else {Scroll[1] = false}};
    if (Scroll[0] == false) {Player.x += Player.x_v};
    if (Scroll[1] == false) {Player.y += Player.y_v}
                              };

  // Horizontal collision check
  var Block = false;  
  function Collision() {for (let i = 1; i < Map.length; i++) {                        
    for (let j = 0; j < Map[i].length; j++) {
      // Player x coordinate lies between those of map element
      if (Map[i][j].x - Player.width < Player.x && Player.x < Map[i][j].x + Map[i][j].width) {                                               
      // Player lands on element
      if (Map[i][j].y - 10 < Player.y + Player.height && 
          Player.y + Player.height <= Map[i][j].y + 10) {
        if (Level != 3 && Level != 5 && i >= 2 && i <= 4)     
          {Player.jump = false; Player.y_v = 0; Player.y = Map[i][j].y - Player.height};
        if ((Level == 3 || Level == 5) && i == 1) {Player.jump = false; Player.y_v = 0; 
          Player.y = Map[i][j].y - Player.height};
        // 'Player.bounce = true' prevents Player from getting frozen by same enemy it bounces off
        if (Level != 6 && (i == 5 || i == 6)) {Player.bounce = true;
        if (Level == 2 && i == 5 && j == 1) {Player.bounce = false}; 
        if (Player.bounce) {Player.y_v = -15} }         };
      // Player hits element from underneath
      if (i == 4 && Map[i][j].y + Map[i][j].height - 10 < Player.y && 
        Player.y < Map[i][j].y + Map[i][j].height - Player.y_v) {Player.y_v = 0};
      // Player y coordinate lies between those of map element  
      if (Map[i][j].y < Player.y + Player.height && Player.y < Map[i][j].y + Map[i][j].height) {
        if (i == 4) {Player.x_v = 0; 
          if (Player.x < Map[i][j].x - Player.width + 5) {Player.x = Map[i][j].x - Player.width;
            if (Scroll[0] == true && Player.x < 507) {Block = "right"}}; 
          if (Player.x > Map[i][j].x+Map[i][j].width - 5) {Player.x = Map[i][j].x+Map[i][j].width;
            if (Scroll[0] == true && Player.x > 517) {Block = "left"}}};
        if (Level != 6 && (i == 5 || i == 6) && Player.bounce == false) 
          {Player.x_v = 0; Block = "hit"};
        if (Level == 6 && (i == 5 || i == 6)) {Player.x_v = 10};  
        if (Level != 6 && i == 1 && keys.up) {Player.y_v = -10};                                      
        if (Level == 1 && i == 7 && keys.down)  
          { Background.src = "BackgroundL2.jpg"; Level++; Map = []; LevelLoad(); 
            Map = JSON.parse(JSON.stringify(MapSpec)); // Level 1 --> 2 transition
            x_b = JSON.parse(JSON.stringify(X_b[1])); y_b = JSON.parse(JSON.stringify(Y_b[1])); 
            Player.x = Map[0].x; Player.y = Map[0].y; Player.Stamina = -2; Player.Surprised = false;
            clearInterval(Reverse); Reverse = setInterval(function () { 
            for (let p = 0; p < Map[6].length; p++) {Map[6][p].y_v *= -1}}, 5000)
          };              
        if (Level == 1 && Player.y < 0)  
          { Background.src = "BackgroundL4.jpg"; Level = 4; Map = []; LevelLoad(); 
            Map = JSON.parse(JSON.stringify(MapSpec)); // Level 1 --> 4 transition
            x_b = JSON.parse(JSON.stringify(X_b[3])); y_b = JSON.parse(JSON.stringify(Y_b[3])); 
            Player.x = Map[0].x; Player.y = Map[0].y; Player.Stamina = 5;
            Player.width = 100; Player.height = 100;
            clearInterval(Reverse); Reverse = setInterval(function () { 
            for (let p = 0; p < Map[6].length; p++) {Map[6][p].y_v *= -1}}, 5000)
          };           
        if (Level == 2 && i == 7 && j == 1 && keys.up) // Level 2 --> 3 transition
          { Background.src = "BackgroundL3.jpg";
            Water = []; Ground = []; Platform = []; Obstacle = []; Drain = [];
            Level++; Map = []; LevelLoad(); 
            x_b = JSON.parse(JSON.stringify(X_b[2])); y_b = JSON.parse(JSON.stringify(Y_b[2]));
            Map = JSON.parse(JSON.stringify(MapSpec)); Player.x = Map[0].x; Player.y = Map[0].y;
            Player.width = 100; Player.height = 100;
            clearInterval(Reverse); Player.Stamina = 5   
          };
        if (Level == 2 && i == 7 && j == 2 && keys.up) // Level 2 --> 6 transition
          { Background.src = "BackgroundL6.jpg";
            Water = []; Ground = []; Platform = []; Obstacle = []; Drain = [];
            Level = 6; Map = []; LevelLoad(); 
            x_b = JSON.parse(JSON.stringify(X_b[5])); y_b = JSON.parse(JSON.stringify(Y_b[5]));
            Map = JSON.parse(JSON.stringify(MapSpec)); Player.x = Map[0].x; Player.y = Map[0].y;
            clearInterval(Reverse); Reverse = setInterval(function () { 
            for (let p = 0; p < Map[6].length; p++) {Map[6][p].y_v *= -1}}, 5000); Player.Stamina = 5   
          };
        if (Level == 4 && Player.x - Map[1][0].x > 5900)  
          { Background.src = "BackgroundL5.jpg"; 
            Water = []; Ground = []; Platform = []; Obstacle = []; Drain = []; Predator = [];
            Level++; Map = []; LevelLoad(); 
            Map = JSON.parse(JSON.stringify(MapSpec)); // Level 4 --> 5 transition
            x_b = JSON.parse(JSON.stringify(X_b[4])); y_b = JSON.parse(JSON.stringify(Y_b[4])); 
            Player.x = Map[0].x; Player.y = Map[0].y; Player.Stamina = 5;
            clearInterval(Reverse); Player.Surprised = false
          };
        if (Level == 6 && Map[7][0].x < Player.x && Player.x < Map[7][0].x + Map[7][0].width &&
          Map[7][0].y < Player.y && Player.y < Map[7][0].y + Map[7][0].height && keys.up)
          { Game = "Over"}           
                                                                                             }                                                   
                                                                                             }                
                                            }                }
                       };

  var Reverse =                      
    setInterval(function () {for (let p = 0; p < Map[6].length; p++) 
      {Map[6][p].y_v *= -1}}, 5000); // Flying mobs switch direction every five seconds                     

  function ScrollFunction() {
    if (Scroll[0] == true) {
      // The below two lines disable Block when Player y coordinates exceed those of obstacle
      if (Player.x < 512) {Player.x++}; if (Player.x > 512) {Player.x--};
      if (Block == "right" && Player.x > 510 || Block == "left" && Player.x < 514) {Block = false};
      // Disable Player.bounce, cannot leave Player invincible after all...
      if (Player.bounce == true) {setTimeout(function() {Player.bounce = false}, 50)};
      // Disable Block two seconds after frozen by enemy
      if (Block == "hit") {
        if (Level == 2) {
          x_b = JSON.parse(JSON.stringify(X_b[1])); y_b = JSON.parse(JSON.stringify(Y_b[1]));
          Map = JSON.parse(JSON.stringify(MapSpec));
          clearInterval(Reverse); Reverse = // Maintain consistency in mob flight range                      
      setInterval(function () {for (let p = 0; p < Map[6].length; p++) {Map[6][p].y_v *= -1}}, 5000);
          Player.x = Map[0].x; Player.y = Map[0].y; Player.Stamina = -2; // Back to spawn you go
                        }; 
        setTimeout(function() {Block = false}, 10);              
                          };
      // Stage horizontally scrolls with player, by moving map opposite to player's velocity  
      for (let i = 0; i < Map.length; i++) 
        {for (let j = 0; j < Map[i].length; j++) {if (Block == false || 
          Block == "right" && Player.x_v < 0 || Block == "left" && Player.x_v > 0) 
          {if ((Level != 4 && Level != 6) || (Level == 4 && i != 7) || (Level == 6 && i != 1)) 
            {Map[i][j].x -= Player.x_v; Block = false};
           if (Level == 6 && i == 1) {Map[i][j].x -= 0.4*Player.x_v; Block = false}}}};
      if (Block == false) {if (Level == 1) {x_b -= 0.15*Player.x_v}; // Moving the background
                           if (Level == 2) {x_b -= 0.33*Player.x_v};
                           if (Level == 3) {x_b -= Player.x_v};
                           if (Level == 4) {x_b -= 0.19*Player.x_v};
                           if (Level == 5) {x_b -= 0.15*Player.x_v};
                           if (Level == 6) {y_b -= 0.25*Player.x_v}};
                           
      // Level 4 exclusive mechanic: Shark x coordinate aligns with player's
      if (Level == 4) 
      {if (Player.x < Map[2][1].x - Player.width && Map[7][0].x != Player.x) 
        {Map[7][0].x = Player.x} else {Map[7][0].x = Map[2][1].x - Map[7][0].width}}
                           };
    if (Scroll[1] == true) {
      if (Player.y < 30) {Player.y = 30}; // Don't want the player to disappear off-stage
      // Stage vertically scrolls with player, by moving map opposite to player's velocity  
      if (Level == 1) {for (let i = 0; i < 8; i++) 
        {for (let j = 0; j < Map[i].length; j++) {Map[i][j].y -= Player.y_v}};
        if (Block == false) {y_b -= 0.25*Player.y_v}}; // Moving the background
      if (Level == 2) {for (let i = 0; i < Map.length; i++) 
        {for (let j = 0; j < Map[i].length; j++) {Map[i][j].y -= Player.y_v}};
        if (Block == false) {y_b -= Player.y_v}};
      if (Level == 3) {for (let i = 0; i < 2; i++) 
        {for (let j = 0; j < Map[i].length; j++) {Map[i][j].y -= Player.y_v}}; y_b -= Player.y_v};
      if (Level == 4) {for (let i = 0; i < 8; i++) 
        {for (let j = 0; j < Map[i].length; j++) {Map[i][j].y -= Player.y_v}};
        if (Block == false) {y_b -= 0.95*Player.y_v}};
      if (Level == 5) {for (let i = 0; i < 3; i++) 
        {for (let j = 0; j < Map[i].length; j++) {Map[i][j].y -= Player.y_v}}; y_b -= 1.6*Player.y_v};
      if (Level == 6) {Map[1][0].y -= 0.5*Player.y_v; for (let i = 2; i < 8; i++) 
        {for (let j = 0; j < Map[i].length; j++) {Map[i][j].y -= Player.y_v}}};         
                           }}; 

  function PlayerMotion() {
    // Map's left boundary for player
    if (Level != 3 && Level != 5) {if (Player.x < Map[2][0].x) {Player.x = Map[2][0].x}}
    else {if (Player.x < Map[1][0].x) {Player.x = Map[1][0].x}}; // If Level *is* 3 or 5 of course

    // Map's right boundary for player
    if (Level != 3 && Level != 5) {
      if (Player.x > Map[2][Map[2].length-1].x + Map[2][Map[2].length-1].width - Player.width) 
        {Player.x = Map[2][Map[2].length-1].x + Map[2][Map[2].length-1].width - Player.width}
                                  }
    else {if (Player.x > Map[1][0].x + Map[1][0].width - Player.width) 
          {Player.x = Map[1][0].x + Map[1][0].width - Player.width}};
    
    // If the player is not jumping apply the effect of friction
    if (Player.jump == false) {if (Level != 6) {Player.x_v *= friction}} else {if (Player.y_v < 10) {
      // If the player is in the air then apply the effect of gravity
      Player.y_v += gravity}}; Player.jump = true; 

    // If a side arrow key is pressed initiate/maintain the relevant horizontal velocity
    if (keys.left) {Player.x_v = -2.5};
    if (Level != 6 && keys.right) {Player.x_v = 2.5};
    if (Level == 6 && keys.right) {if (Player.x_v < 2.5) {Player.x_v = 2.5}};

    // Emergency brakes! <:-O
    if (Level == 6 && Player.x > 550 && Player.x_v > 2.5) {Player.x_v = 2.5};
                          };                              
                       
  function MobMotion() {
    if (Level != 5 && Level != 6) {
    for (let d = 0; d < Map[5].length; d++) {Map[5][d].x += Map[5][d].x_v;
    Map[5][d].y++;
    for (let i = 2; i < 5; i++) {for (let j = 0; j < Map[i].length; j++) {
      // Duck x coordinate lies between those of solid element
      if (Map[i][j].x - Map[5][d].width < Map[5][d].x && 
        Map[5][d].x < Map[i][j].x + Map[i][j].width) 
        {// Duck y coordinate lies between those of solid element 
        if (i == 4 && Map[i][j].y + 10 < Map[5][d].y + Map[5][d].height 
          && Map[5][d].y < Map[i][j].y + Map[i][j].height) {Map[5][d].x_v *= -1};
        // Duck y coordinate lies directly above those of solid element
      if (Map[i][j].y < Map[5][d].y + Map[5][d].height && 
      Map[5][d].y + Map[5][d].height <= Map[i][j].y + 10) {
        Map[5][d].y = Map[i][j].y - Map[5][d].height
                                                          }              
        }                                                                }     
                                }                               }
                                  };

    if (Level == 5) {for (let d = 0; d < 9; d++) {Map[2][d].x += Map[2][d].x_v;
      Map[2][d].y++;
      for (let g = 0; g < Map[1].length; g++) {
        // Chicken x coordinate lies between those of solid element
        if (Map[1][g].x - Map[2][d].width < Map[2][d].x && 
          Map[2][d].x < Map[1][g].x + Map[1][g].width)       {
          // Chicken y coordinate lies directly above those of solid element
            if (Map[1][g].y < Map[2][d].y + Map[2][d].height && 
            Map[2][d].y + Map[2][d].height <= Map[1][g].y + 10) 
              {Map[2][d].y = Map[1][g].y - Map[2][d].height} }                                                                     
                                              }              }
                    };                            
      // Flying physics for flying mobs
      if (Level != 5) {for (let p = 0; p < Map[6].length; p++) {Map[6][p].y += Map[6][p].y_v}};                        
                       };
  
  // "I'm gonna get you!" >:-D                   
  function Sweep() {
    if (Level == 1 || Level == 4 || Level == 6) {Map[8][0].x += Map[8][0].x_v};
    if (Level == 3) {Map[2][0].x += Map[2][0].x_v}
                   };

  // Too bad, try again
  function Death() {
    if (Level == 1 || Level == 6) {
      if (Player.y > 580 || Player.x < Map[8][0].x + 0.5*Map[8][0].width) {
        Map = JSON.parse(JSON.stringify(MapSpec)); Player.x = Map[0].x; Player.y = Map[0].y;
        Player.x_v = 0; Player.y_v = 0; Player.Lives--; Player.Stamina = 5;
        x_b = JSON.parse(JSON.stringify(X_b[Level-1])); 
        y_b = JSON.parse(JSON.stringify(Y_b[Level-1]));
      clearInterval(Reverse); Reverse =                        
      setInterval(function () {for (let p = 0; p < Map[6].length; p++) {Map[6][p].y_v *= -1}}, 5000)                    
                                                                                          }  
                                  };
    if (Level == 4) {
      if ((Player.x < Map[2][1].x && Player.y > Map[7][0].y) || 
          Player.x < Map[8][0].x + 0.5*Map[8][0].width) {
        Map = JSON.parse(JSON.stringify(MapSpec)); Player.x = Map[0].x; Player.y = Map[0].y;
        Player.x_v = 0; Player.y_v = 0; Player.Lives--; Player.Stamina = 5;
        x_b = JSON.parse(JSON.stringify(X_b[3])); y_b = JSON.parse(JSON.stringify(Y_b[3]));
      clearInterval(Reverse); Reverse =                        
      setInterval(function () {for (let p = 0; p < Map[6].length; p++) {Map[6][p].y_v *= -1}}, 5000)                    
                                                        }  
                    }                                         
                   };

  var Text = "";                 
  function Message() {// Send different messages to player depending on level and position
    if (Level == 1) {if (Player.x <= 400) {Text = "--> RUN! -->"};
      if (400 < Player.x && Player.x < 550) {Text = ""};
      if (550 < Player.x && Player.x < 700) {Text = "Easy: Press the Down key to enter the drain"};
      if (Player.x >= 700 && Player.y > 50) {Text="Hard: Press the Up key to climb the water column"};
      if (Player.x >= 700 && Player.y <= 50) {Text = 
        "Hope you bought yourself enough time to make the climb"}
                    };
    if (Level == 2) {if (Player.y > Map[2][1].y) {
      if (Player.x < 100) {Text = 
      "No one's chasing after you this level, don't worry"};
      if (100 <= Player.x && Player.x < 400) {Text = 
      "But if you get hit, then it's back to the spawn for you!"};
      if (400 <= Player.x && Player.x < 550) {Text = ""};
      if (Player.x >= 550) {Text =
      "This time, press the Up key to enter the drain above"}
                                                 }
                     else {
      if (1000 < Player.x - Map[2][1].x && Player.x - Map[2][1].x < 2000) {Text = 
      "You found the glitch! Now head --> right --> to locate the portal."};
      if (2200 < Player.x - Map[2][1].x && Player.x - Map[2][1].x < 2500) {Text = 
      "Press the Up key to enter the portal."                             }; 
      if (Player.x - Map[2][1].x < 1000 || Player.x - Map[2][1].x > 2500 ||
          (2000 < Player.x - Map[2][1].x && Player.x - Map[2][1].x < 2200)) {Text = ""}
                                                 }            
                    };
    if (Level == 3) {if (Player.x <= 400) {Text = "--> I'd keep moving if I were you -->"};
      if (Player.x - Map[1][0].x > 500 && Player.x - Map[1][0].x < 1000) 
        {Text = 'Reflection: "Was escaping from the farm worthwhile?"'};
      if (Player.x - Map[1][0].x > 1000 && Player.x - Map[1][0].x < 1500) 
        {Text = 'Reflection: "Foxes, eagles, everything\'s out to get me!"'};
      if (Player.x - Map[1][0].x > 1500 && Player.x - Map[1][0].x < 1750) 
        {Text = 'Reflection: "Escaped one predator, only to have to..."'};
      if (Player.x - Map[1][0].x > 1750 && Player.x - Map[1][0].x < 2000)  
        {Text = 'Reflection: "... constantly watch over my shoulder for another"'};
      if (Player.x - Map[1][0].x > 2000 && Player.x - Map[1][0].x < 2500) 
        {Text = 'Reflection: "As well as having to fend for myself"'};
      if (Player.x - Map[1][0].x > 2500 && Player.x - Map[1][0].x < 3000) 
        {Text = 'Reflection: "How long does a chicken survive in the wild for?"'};
      if (Player.x - Map[1][0].x > 3000 && Player.x - Map[1][0].x < 3500) 
        {Text = 'Reflection: "I know that I cannot keep running forever"'};
      if (Player.x - Map[1][0].x > 3500 && Player.x - Map[1][0].x < 3750) 
        {Text = 'Reflection: "Even if I could, what\'s the point of..."'};
      if (Player.x - Map[1][0].x > 3750 && Player.x - Map[1][0].x < 4000)
        {Text = 'Reflection: "... perpetually living in fear?"'};
      if (Player.x - Map[1][0].x > 4000 && Player.x - Map[1][0].x < 4500) 
        {Text = 'Reflection: "Why don\'t I just give up already?"'};
      if (Player.x - Map[1][0].x > 4500 && Player.x - Map[1][0].x < 5000) 
        {Text = 'Reflection: "I can feel my bones becoming brittle, my muscles wasting away"'};
      if (Player.x - Map[1][0].x > 5000 && Player.x - Map[1][0].x < 5500) 
        {Text = 'Reflection: "I regret not flying away to a tropical paradise"'};
      if (Player.x - Map[1][0].x > 5500 && Player.x - Map[1][0].x < 6000) 
        {Text = 'Reflection: "I\'m an old rooster now, I don\'t have much longer"'};
      if (Player.x - Map[1][0].x > 6000 && Player.x - Map[1][0].x < 6250) 
        {Text = 'Reflection: "Even the youngest chick I knew on the farm met..."'};
      if (Player.x - Map[1][0].x > 6250 && Player.x - Map[1][0].x < 6500)
        {Text = 'Reflection: "... their demise in the abbatoir years ago"'};
      if (Player.x - Map[1][0].x > 6500 && Player.x - Map[1][0].x < 7000) 
        {Text = 'Reflection: "At least I have the privilege of not dying young on the farm"'};
      if (Player.x - Map[1][0].x > 7000) 
       {Text = 'Reflection: "I accept my fate now, Grim Reaper, take me away!"'};
                    };
    if (Level == 4) {if (Player.x <= 400) {Text = "--> Sky Chase! -->"};
      if (Player.x - Map[1][0].x > 1000 && Player.x - Map[1][0].x < 1500) 
        {Text = "There's a hungry shark stalking you in the sea below, so don't fall"};
      if (Player.x - Map[1][0].x > 1500 && Player.x - Map[1][0].x < 2800) 
        {Text = ""};
      if (Player.x - Map[1][0].x > 2800  && Player.x - Map[1][0].x < 3500) 
        {Text = "You'll have to make a leap of faith, as far right as you can go"};
      if (Player.x - Map[1][0].x > 3500 && Player.x < 4500) 
        {Text = ""};
      if (Player.x - Map[1][0].x > 4500 && Player.x < 5500) 
        {Text = "Thank you for flying with Fryanair"};
      if (Player.x - Map[1][0].x > 5500) 
        {Text = "Keep heading and spamming Right as the eagle approaches to progress."}
                    };
    if (Level == 5) {if (Player.x <= 400) {Text = "--> In your own time... -->"};
      if (Player.x - Map[1][0].x > 500 && Player.x - Map[1][0].x < 1000) 
        {Text = 'Reflection: "How much I was missing out on in life..."'};
      if (Player.x - Map[1][0].x > 1000 && Player.x - Map[1][0].x < 1250) 
        {Text = 'Reflection: "To think that being on the verge of execution is what..."'};
      if (Player.x - Map[1][0].x > 1250 && Player.x - Map[1][0].x < 1500) 
        {Text = 'Reflection: "... it took to give me the window of opportunity I needed..."'};  
      if (Player.x - Map[1][0].x > 1500 && Player.x - Map[1][0].x < 1750) 
        {Text = 'Reflection: "... to make my escape."'};
      if (Player.x - Map[1][0].x > 1750 && Player.x - Map[1][0].x < 2000)  
        {Text = 'Reflection: "Escape or die, I would\'ve been free either way."'};
      if (Player.x - Map[1][0].x > 2000 && Player.x - Map[1][0].x < 2250) 
        {Text = 'Reflection: "One minute, I\'m chased by my would-be killer..."'};
      if (Player.x - Map[1][0].x > 2250 && Player.x - Map[1][0].x < 2500) 
        {Text = 'Reflection: "... up a waterfall, and the next I discover..."'};  
      if (Player.x - Map[1][0].x > 2500 && Player.x - Map[1][0].x < 2750) 
        {Text = 'Reflection: "... an ability to walk on clouds."'};
      if (Player.x - Map[1][0].x > 2750 && Player.x - Map[1][0].x < 3000) 
        {Text = 'Reflection: "I\'ll never forget the priceless look on that..."'};  
      if (Player.x - Map[1][0].x > 3000 && Player.x - Map[1][0].x < 3250) 
        {Text = 'Reflection: "... bloodthirsty butcher\'s face when he realised that..."'};
      if (Player.x - Map[1][0].x > 3250 && Player.x - Map[1][0].x < 3500) 
        {Text = 'Reflection: "... he was no longer able to pursue me."'};  
      if (Player.x - Map[1][0].x > 3500 && Player.x - Map[1][0].x < 3750) 
        {Text = 'Reflection: "Then the eagle took over and the rest is history."'};
      if (Player.x - Map[1][0].x > 3750 && Player.x - Map[1][0].x < 4000)
        {Text = 'Reflection: "The adrenaline rush... I never felt so alive!"'};
      if (Player.x - Map[1][0].x > 4000 && Player.x - Map[1][0].x < 4250) 
        {Text = 'Reflection: "Apart from sharks during the rough spring tides,..."'};
      if (Player.x - Map[1][0].x > 4250 && Player.x - Map[1][0].x < 4500) 
        {Text = 'Reflection: "... I need not worry about predators,..."'};  
      if (Player.x - Map[1][0].x > 4500 && Player.x - Map[1][0].x < 4750) 
        {Text = 'Reflection: "... least of all on dry land."'};
      if (Player.x - Map[1][0].x > 4750 && Player.x - Map[1][0].x < 5000) 
        {Text = 'Reflection: "As for the other chickens,..."'};
      if (Player.x - Map[1][0].x > 5000 && Player.x - Map[1][0].x < 5250) 
        {Text = 'Reflection: "the nesting hens were unable to escape the farm."'};
      if (Player.x - Map[1][0].x > 5250 && Player.x - Map[1][0].x < 5500) 
        {Text = 'Reflection: "They and their chicks will be spared..."'};  
      if (Player.x - Map[1][0].x > 5500 && Player.x - Map[1][0].x < 5750) 
        {Text = 'Reflection: "... for a few months anyway."'};
      if (Player.x - Map[1][0].x > 5750 && Player.x - Map[1][0].x < 6000) 
        {Text = 'Reflection: "A couple of us didn\'t survive the cloud passage."'};  
      if (Player.x - Map[1][0].x > 6000 && Player.x - Map[1][0].x < 6250) 
        {Text = 'Reflection: "Not that they\'ll be missed."'};
      if (Player.x - Map[1][0].x > 6250 && Player.x - Map[1][0].x < 6500)
        {Text = 'Reflection: "Back on the farm, they used to scoff the vast majority of..."'};
      if (Player.x - Map[1][0].x > 6500 && Player.x - Map[1][0].x < 6750) 
        {Text = 'Reflection: "... our grain feed, leaving the rest of us to starve."'};
      if (Player.x - Map[1][0].x > 6750 && Player.x - Map[1][0].x < 7000) 
       {Text = 'Reflection: "Their beefy build combined with their poor agility..."'};
      if (Player.x - Map[1][0].x > 7000 && Player.x - Map[1][0].x < 7250) 
       {Text = 'Reflection: "... made them easier pickings for the eagles."'};
      if (Player.x - Map[1][0].x > 7250 && Player.x - Map[1][0].x < 7500) 
       {Text = 'Reflection: "Ultimately, their greed was their own undoing."'};
      if (Player.x - Map[1][0].x > 7500 && Player.x - Map[1][0].x < 7750) 
       {Text = 'Reflection: "Good riddance!"'};
      if (Player.x - Map[1][0].x > 7750 && Player.x - Map[1][0].x < 8000) 
       {Text = 'Reflection: "The remoteness of this island combined with its tranquility..."'};
      if (Player.x - Map[1][0].x > 8000 && Player.x - Map[1][0].x < 8250) 
       {Text = 'Reflection: "... make it an idyllic spot to create multiple families."'};
      if (Player.x - Map[1][0].x > 8250 && Player.x - Map[1][0].x < 8500) 
       {Text = 'Reflection: "Very few roosters here for me to compete with..."'};
      if (Player.x - Map[1][0].x > 8500 && Player.x - Map[1][0].x < 8750) 
       {Text = 'Reflection: "... for the abundance of hens."'};
      if (Player.x - Map[1][0].x > 8750 && Player.x - Map[1][0].x < 9000) 
       {Text = 'Reflection: "The nearby jungle has a steady supply of fruit and seeds,..."'};
      if (Player.x - Map[1][0].x > 9000 && Player.x - Map[1][0].x < 9250) 
       {Text = 'Reflection: "... but it can only sustain our population up to,..."'};
      if (Player.x - Map[1][0].x > 9250 && Player.x - Map[1][0].x < 9500) 
       {Text = 'Reflection: "... I guess, a couple hundred."'};
      if (Player.x - Map[1][0].x > 9500 && Player.x - Map[1][0].x < 10000) 
       {Text = 'Reflection: "I must return to camp soon, I have a settlement to build."'};
                    };
    if (Level == 6) {if (Player.x <= 400) {Text = "--> Flee the Matrix! -->"};
      if (Player.x - Map[2][0].x > 1000 && Player.x - Map[2][0].x < 2000) 
        {Text = 'Reflection: "I didn\'t fit in with the other chickens on the farm."'};
      if (Player.x - Map[2][0].x > 2000 && Player.x - Map[2][0].x < 3000) 
        {Text = 'Reflection: "Cowering behind the comfort and security provided,..."'};
      if (Player.x - Map[2][0].x > 3000  && Player.x - Map[2][0].x < 4000) 
        {Text = 'Reflection: "... fattening ourselves up for the slaughter."'};
      if (Player.x - Map[2][0].x > 4000 && Player.x - Map[2][0].x < 6000) 
        {Text = 'Reflection: "What happens to the other chickens is no longer my concern."'};
      if (Player.x - Map[2][0].x > 6000 && Player.x - Map[2][0].x < 7000) 
        {Text = 'Reflection: "I\'m in charge of my destiny now."'};
      if (Player.x - Map[2][0].x > 7000 && Player.x - Map[2][0].x < 8000) 
        {Text = 'Reflection: "My destiny is my journey to traverse alone."'};
      if (Player.x - Map[2][0].x > 8000 && Player.x - Map[2][0].x < 9500) 
        {Text = 'Reflection: "And I choose the route to freedom!"'};
      if (Player.x - Map[2][0].x > 9500) 
        {Text = "Press Up to mount the light bike. It\'s your only escape!"}
                    };                                                                
                     }; 
                     
  function ImageFlip() {// When the character direction changes, so does the image used for it
    if (Player.jump == false) 
      {if (keys.right) {Chicken.src = "ChickenR.gif"}; if (keys.left) {Chicken.src = "ChickenL.gif"}}
    else {// Default image based on existing image
      if (Chicken.src == "ChickenR.gif") {Chicken.src = "ChickenJR.gif"};
      if (Chicken.src == "ChickenL.gif") {Chicken.src = "ChickenJL.gif"};
      // Key press overrides default image selection, so it appears later in function
      if (keys.right) {Chicken.src = "ChickenJR.gif"};
      if (keys.left) {Chicken.src = "ChickenJL.gif"}
         };
    
    if (Level == 1 || Level == 4) {for (let d = 0; d < Map[5].length; d++) {
      if (Map[5][d].x_v > 0) {DuckImage[d].src = "DuckR.gif"};
      if (Map[5][d].x_v < 0) {DuckImage[d].src = "DuckL.gif"}
                                                                           };
                    };
    if (Level == 2) {for (let d = 0; d < Map[5].length; d++) {
      if (Map[5][d].width < 30 && Map[5][d].x_v > 0) {DuckImage[d].src = "RatR.gif"};
      if (Map[5][d].width < 30 && Map[5][d].x_v < 0) {DuckImage[d].src = "RatL.gif"};
      if (Map[5][d].width > 30 && Map[5][d].x_v > 0) {DuckImage[d].src = "FishR.gif"};
      if (Map[5][d].width > 30 && Map[5][d].x_v < 0) {DuckImage[d].src = "FishL.gif"}
                                                             };
                    };
    if (Level == 1) {Farmer.src = "Farmer.gif"};
    if (Level == 3) {Farmer.src = "Reaper.gif"};
    if (Level == 4) {Farmer.src = "Eagle.gif"};
    if (Level == 6) {Farmer.src = "Matrix.gif"}                                   
                       };
  
  var Screen = new Image(); var Game = "Off"; 

  function Scene() {// Cover pages are displayed
    if (Game == "Off") {Screen.src = "Menu.jpg"; Background.src = "BackgroundL1.jpg";
      ctx.drawImage(Screen, 0, 0, canvas.width, canvas.height); canvas.onclick = [];
      Spawn = []; Ground = []; Platform = []; Obstacle = []; Duck = []; Pigeon = []; 
      Water = []; Drain = []; Predator = []; MapSpec = []; Map = [];
      setTimeout(function() {ctx.font = "30px Arial"; ctx.fillStyle = "green";
        ctx.fillText("Click here to play", 380, 300);
        canvas.onclick = function() {Level = 1; LevelLoad(); 
          Map = JSON.parse(JSON.stringify(MapSpec));
          x_b = JSON.parse(JSON.stringify(X_b[0])); 
          y_b = JSON.parse(JSON.stringify(Y_b[0])); 
          Player.x = Map[0].x; Player.y = Map[0].y; Player.Lives = 5; Player.Stamina = 5;
          Player.width = 20; Player.height = 20;
          clearInterval(Reverse); 
          Reverse = setInterval(function () {if (Level==1 || Level==2 || Level==4 || Level==6) 
            {for (let p = 0; p < Map[6].length; p++) {Map[6][p].y_v *= -1}}}, 5000);
          Game = "On"               }
                            }, 3000)};

    if (Level == 1 && Player.Lives < 0) {Game = "Over"; // Oh no! <;-(
      ctx.clearRect(0, 0, canvas.width, canvas.height); canvas.onclick = [];
      Screen.src = "GameOver1.jpg";
      ctx.drawImage(Screen, 0, 0, canvas.width, canvas.height);
      setTimeout(function() {ctx.font = "30px Arial"; ctx.fillStyle = "white";
        ctx.fillText("Click to return to menu", 360, 300);
        canvas.onclick = function() {Level = 0; Game = "Off"}
                            }, 3000)};

    if (Level == 4 && Player.Lives < 0) {Game = "Over"; // Oh no! <;-(
      ctx.clearRect(0, 0, canvas.width, canvas.height); canvas.onclick = [];
      Pigeon = [];
      Screen.src = "GameOver2.jpg";
      ctx.drawImage(Screen, 0, 0, canvas.width, canvas.height);
      setTimeout(function() {ctx.font = "30px Arial"; ctx.fillStyle = "turquoise";
        ctx.fillText("Click to return to menu", 360, 300);
        canvas.onclick = function() {Level = 0; Game = "Off"}
                            }, 3000)};
                            
    if (Level == 6 && Player.Lives < 0) {Game = "Over"; // Oh yes, the farm's where you belong >:-D
      ctx.clearRect(0, 0, canvas.width, canvas.height); canvas.onclick = [];
      Screen.src = "GameOver3.jpg";
      ctx.drawImage(Screen, 0, 0, canvas.width, canvas.height);
      setTimeout(function() {ctx.font = "30px Arial"; ctx.fillStyle = "pink";
        ctx.fillText("Click to return to menu", 360, 300);
        canvas.onclick = function() {Level = 0; Game = "Off"}
                            }, 3000)};                        
                          
    if (Level == 3) {
      if (Player.x < Map[2][0].x + 0.5*Map[2][0].width) {Game = "Over"; // Thanks for playing
      ctx.clearRect(0, 0, canvas.width, canvas.height); canvas.onclick = [];
      Screen.src = "Ending1.jpg";
      ctx.drawImage(Screen, 0, 0, canvas.width, canvas.height);
      setTimeout(function() {ctx.font = "30px Arial"; ctx.fillStyle = "white";
        ctx.fillText("Click to return to menu", 360, 300);
        canvas.onclick = function() {Level = 0; Game = "Off"}
                            }, 3000)                    }  
                    };
                    
    if (Level == 5) {
      if (Player.x - Map[1][0].x > 9900) {Game = "Over"; // Thanks for playing
      ctx.clearRect(0, 0, canvas.width, canvas.height); canvas.onclick = [];
      Screen.src = "Ending2.jpg";
      ctx.drawImage(Screen, 0, 0, canvas.width, canvas.height);
      setTimeout(function() {ctx.font = "30px Arial"; ctx.fillStyle = "lime";
        ctx.fillText("Click to return to menu", 360, 300);
        canvas.onclick = function() {Level = 0; Game = "Off"}
                            }, 3000)     }  
                    };
                    
    if (Level == 6 && Game == "Over" && Player.Lives > 0) { // Tron style!
      ctx.clearRect(0, 0, canvas.width, canvas.height); canvas.onclick = [];
      Screen.src = "Ending3.jpg";
      ctx.drawImage(Screen, 0, 0, canvas.width, canvas.height);
      setTimeout(function() {ctx.font = "30px Arial"; ctx.fillStyle = "pink";
      ctx.fillText("Click to return to menu", 360, 300);
      canvas.onclick = function() {Level = 0; Game = "Off"}
                              }, 3000)                    }                                                                                 
                          };  
  
  // A picture paints a thousand words                        
  const Icon = [new Image(), new Image()]; Icon[0].src = "Stamina.gif"; Icon[1].src = "Lives.gif";
  
  function Proximity() {// When the player is close to capture
    if (((Level == 1 || Level == 4 || Level == 6) && Player.x - Map[8][0].x < 500) || 
        (Level == 3 && Player.x - Map[2][0].x < 500)) 
      {Player.Surprised = true} else {Player.Surprised = false}
                       };

  var level;                     

  function loop() {if (Game == "On") {
    ImageLoad(); ImageFlip();
    PlayerMotion(); ScrollConditions(); ScrollFunction(); Collision();
    
    if (Level == 1 || Level == 2 || Level == 4 || Level == 5 || Level == 6) {MobMotion()}; 
    if (Level == 1 || Level == 3 || Level == 4 || Level == 6) {Sweep()};

    // Rendering the canvas, the player, the platforms and the obstacles
    RenderCanvas(); RenderMap(); RenderPlayer();

    // Gamestate
    if (Level == 1 || Level == 4 || Level == 6) {Death()};

    // Updating canvas messages
    Message(); if (Level == 1 || Level == 3 || Level == 4 || Level == 6) {Proximity()};

    // Displaying the stamina and lives
    ctx.drawImage(Icon[0], 10, 10, 100, 60); ctx.drawImage(Icon[1], 450, 10, 60, 60);
    ctx.font = "30px Arial"; 
    if (Level == 1) {ctx.fillStyle = "black"; level = "1 - Farm"}; 
    if (Level == 2) {ctx.fillStyle = "white"; level = "2 - Sewer"};
    if (Level == 3) {ctx.fillStyle = "turquoise"; level = "3 - Desert"};
    if (Level == 4) {ctx.fillStyle = "lime"; level = "2 - Sky"};
    if (Level == 5) {ctx.fillStyle = "orange"; level = "3 - Beach"};
    if (Level == 6) {ctx.fillStyle = "pink"; level = "3 - Off-Grid"};
    ctx.fillText("X " + Player.Stamina, 100, 50); 
    ctx.fillText("X " + Player.Lives, 500, 50);
    ctx.fillText("Level: " + level, 750, 50);
    ctx.fillText(Text, 10, 100);
    // Expressing the player's shock of the prospect of being captured
    if (Player.Surprised) {
    ctx.fillText("!", Player.x + 0.5*Player.width, Player.y - 30)}      
                                     };
    
    Scene();
                  };

  canvas = document.getElementById("canvas");
  ctx = canvas.getContext("2d"); ctx.canvas.height = 576; ctx.canvas.width = 1024;
    
  // Adding the event listeners
  document.addEventListener("keydown",keydown); document.addEventListener("keyup",keyup);
  setInterval(loop,22);                            

  // Disabling keyboard scrolling, for obvious reasons
  window.addEventListener("keydown", function(e) {
    if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
        e.preventDefault();                                                           }
                                                 }, false);

 </script>
</html>